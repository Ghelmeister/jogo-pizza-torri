<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Pizza Bird - Torri Torri</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background-color: #fff; font-family: sans-serif; text-align: center; }
    canvas { display: none; margin: 20px auto; background: linear-gradient(#facc15, #fff); border: 5px solid #000; touch-action: manipulation; }
    #formulario, #mensagem, #vidas, #reiniciar, #instrucoes, #btnInstagram {
      margin-top: 10px;
      font-size: 18px;
    }
    #formulario input, #formulario button, #instrucoes button {
      margin: 10px;
      padding: 10px;
      font-size: 16px;
      width: 80%;
      max-width: 300px;
    }
    #reiniciar, #btnInstagram {
      padding: 10px 20px;
      background-color: #facc15;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      display: none;
    }
    #mensagem {
      display: none;
      color: green;
      font-weight: bold;
    }
    #instrucoes {
      display: block;
      padding: 20px;
    }
  </style>
</head>
<body>
  <h1 style="color: #facc15; margin: 20px 0;">üçï Pizza Bird üçï</h1>
  <div id="instrucoes">
    <p>üëÜ Toque na tela ou aperte uma tecla para fazer a pizza voar</p>
    <p>üö´ N√£o deixe ela bater nos canos</p>
    <p>üéØ Passe por 3 canos para ganhar um cupom!</p>
    <p>üìù Voc√™ precisa se cadastrar para jogar</p>
    <button onclick="mostrarFormulario()">Entendi, quero jogar!</button>
  </div>
  <div id="formulario" style="display: none;">
    <input type="text" id="nome" placeholder="Seu nome" required><br>
    <input type="text" id="whatsapp" placeholder="WhatsApp" required><br>
    <input type="email" id="email" placeholder="E-mail" required><br>
    <button onclick="iniciarComCadastro()">Come√ßar Jogo</button>
  </div>
  <canvas id="gameCanvas" width="320" height="480"></canvas>
  <div id="vidas">Vidas restantes: <span id="vidasContador">4</span></div>
  <div id="mensagem"></div>
  <button id="reiniciar">Tente novamente</button>
  <button id="btnInstagram" onclick="window.location.href='https://www.instagram.com/toritoripizzas/'">Voltar ao Instagram</button>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const pizza = new Image();
    pizza.src = "https://cdn-icons-png.flaticon.com/512/3595/3595455.png";

    let x, y, gravity, velocity, pipe, pipeGap, pipeWidth, pipeSpeed, gameRunning, passedPipes;
    let vidas = 4;
    let etapa = 1;
    let jogouAntes = localStorage.getItem("jogoFinalizado") === "true";
    const mensagem = document.getElementById("mensagem");
    const reiniciar = document.getElementById("reiniciar");
    const vidasContador = document.getElementById("vidasContador");

    if (jogouAntes) {
      document.body.innerHTML = "<h1 style='margin-top: 50px;'>Voc√™ j√° participou e usou seu desconto! Obrigado por jogar üçï</h1><button onclick=\"window.location.href='https://www.instagram.com/toritoripizzas/'\" style='margin-top: 20px; padding: 10px 20px; background-color: #facc15; border: none; border-radius: 5px; font-weight: bold; cursor: pointer;'>Voltar ao Instagram</button>";
    }

    function mostrarFormulario() {
      document.getElementById("instrucoes").style.display = 'none';
      document.getElementById("formulario").style.display = 'block';
    }

    function iniciarComCadastro() {
      const nome = document.getElementById('nome').value;
      const whatsapp = document.getElementById('whatsapp').value;
      const email = document.getElementById('email').value;

      if (!nome || !whatsapp || !email) {
        alert("Por favor, preencha todos os campos.");
        return;
      }

      fetch("https://script.google.com/macros/s/AKfycbz9LIgaMVJdsFNgTlXgHBcYYL6W21xE97XvRC-4dNmj_3Y1bnZeUpXYQ2ShJPCzJlgcqA/exec", {
        method: "POST",
        body: JSON.stringify({ nome, whatsapp, email })
      });

      document.getElementById("formulario").style.display = 'none';
      canvas.style.display = 'block';
      iniciarJogo();
    }

    function configurarEtapa() {
      if (etapa === 1) {
        pipeGap = 180;
        pipeSpeed = 1;
      } else if (etapa === 2) {
        pipeGap = 140;
        pipeSpeed = 1.5;
      } else if (etapa === 3) {
        pipeGap = 110;
        pipeSpeed = 2;
      }
    }

    function iniciarJogo() {
      x = 50;
      y = 150;
      gravity = 0.8;
      velocity = 0;
      pipe = [];
      for (let i = 0; i < 3; i++) {
        pipe.push({
          x: canvas.width + i * 150,
          y: Math.floor(Math.random() * 100) - 100,
          counted: false
        });
      }
      pipeWidth = 50;
      gameRunning = true;
      passedPipes = 0;
      mensagem.style.display = 'none';
      reiniciar.style.display = 'none';
      configurarEtapa();
      draw();
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let i = 0; i < pipe.length; i++) {
        ctx.fillStyle = "#000";
        ctx.fillRect(pipe[i].x, pipe[i].y, pipeWidth, 200);
        ctx.fillRect(pipe[i].x, pipe[i].y + 200 + pipeGap, pipeWidth, canvas.height);

        pipe[i].x -= pipeSpeed;

        if (pipe[i].x + pipeWidth < x && !pipe[i].counted) {
          pipe[i].counted = true;
          passedPipes++;
        }

        if (pipe[i].x + pipeWidth < 0) {
          pipe[i].x = canvas.width + 150;
          pipe[i].y = Math.floor(Math.random() * 100) - 100;
          pipe[i].counted = false;
        }

        if (x + 30 >= pipe[i].x && x <= pipe[i].x + pipeWidth &&
            (y <= pipe[i].y + 200 || y + 30 >= pipe[i].y + 200 + pipeGap)) {
          gameRunning = false;
        }
      }

      ctx.drawImage(pizza, x, y, 30, 30);

      velocity += gravity;
      y += velocity;

      if (y > canvas.height || y < 0) {
        gameRunning = false;
      }

      if (gameRunning) {
        requestAnimationFrame(draw);
      } else {
        fimDeEtapa();
      }
    }

    function fimDeEtapa() {
      if (passedPipes >= 3) {
        if (etapa === 1) {
          mensagem.innerHTML = "üéâ Voc√™ ganhou <strong>R$5</strong> de desconto! Use o cupom TORRI5.";
          etapa = 2;
        } else if (etapa === 2) {
          mensagem.innerHTML = "üéâ Voc√™ ganhou <strong>R$10</strong> de desconto! Use o cupom TORRI10.";
          etapa = 3;
        } else if (etapa === 3) {
          mensagem.innerHTML = "üéâ Parab√©ns! Voc√™ ganhou <strong>R$20</strong> de desconto! Use o cupom TORRI20.";
          localStorage.setItem("jogoFinalizado", "true");
          document.getElementById("btnInstagram").style.display = 'inline-block';
          return;
        }
      } else {
        mensagem.innerHTML = "üòÖ Voc√™ n√£o completou a fase. Tente novamente!";
      }

      mensagem.style.display = "block";
      vidas--;
      vidasContador.textContent = vidas;

      if (vidas > 0) {
        reiniciar.style.display = 'inline-block';
      } else {
        mensagem.innerHTML += "<br>üí• Fim de jogo. Obrigado por jogar!";
        document.getElementById("btnInstagram").style.display = 'inline-block';
      }
    }

    reiniciar.addEventListener('click', () => {
      iniciarJogo();
    });

    function pular() {
      if (gameRunning) velocity = -7;
    }

    document.addEventListener("keydown", pular);
    canvas.addEventListener("touchstart", pular);

    pizza.onload = () => {};
  </script>
</body>
</html>